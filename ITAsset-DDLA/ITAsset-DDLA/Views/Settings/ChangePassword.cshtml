@using ITAsset_DDLA.Database.Models.ViewModels.Account
@model ChangePasswordViewModel
@{
    ViewData["Title"] = "Şifrəni dəyiş";
}

<div class="container mt-5">
    <div class="logo-header">
        <img src="~/assets/images/ddlaLogo.png" alt="DDLA Logo" class="img-fluid">
        <div class="logo-text">
            <h1>Şifrəni dəyiş</h1>
            <small>Hesab təhlükəsizliyinizi təkmilləşdirin</small>
        </div>
    </div>
    @* <--!> *@

    <div class="card mt-4 shadow-sm">
        <div class="card-header text-white" style="background: linear-gradient(180deg, var(--primary-color), #1a2530)">
            <h3 class="card-title mb-0">
                <i class="fas fa-key me-2"></i> Şifrə dəyişikliyi
            </h3>
        </div>
        <div class="card-body">
            <form asp-action="ChangePassword" method="post" id="passwordChangeForm">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label asp-for="CurrentPassword" class="form-label fw-semibold">
                                <i class="fas fa-lock me-2"></i> Cari şifrə
                            </label>
                            <div class="input-group">
                                <input asp-for="CurrentPassword" class="form-control border-end-0" type="password"
                                       id="currentPassword" placeholder="Cari şifrənizi daxil edin">
                                <button class="btn btn-outline-secondary toggle-password" type="button"
                                        data-target="currentPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <span asp-validation-for="CurrentPassword" class="text-danger small d-block mt-1"></span>
                        </div>
                    </div>
                </div>

                <div class="row mt-2">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label asp-for="NewPassword" class="form-label fw-semibold">
                                <i class="fas fa-key me-2"></i> Yeni şifrə
                            </label>
                            <div class="input-group">
                                <input asp-for="NewPassword" class="form-control border-end-0" type="password"
                                       id="newPassword" placeholder="Yeni şifrəni daxil edin">
                                <button class="btn btn-outline-secondary toggle-password" type="button"
                                        data-target="newPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="password-strength mt-2">
                                <div class="progress" style="height: 5px;">
                                    <div id="passwordStrengthBar" class="progress-bar" role="progressbar"></div>
                                </div>
                                <small id="passwordStrengthText" class="text-muted d-block mt-1"></small>
                            </div>
                            <div class="form-text small text-muted">
                                Şifrə ən azı 6 simvoldan ibarət olmalıdır.
                            </div>
                            <span asp-validation-for="NewPassword" class="text-danger small d-block mt-1"></span>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label asp-for="ConfirmPassword" class="form-label fw-semibold">
                                <i class="fas fa-key me-2"></i> Yeni şifrə təkrarı
                            </label>
                            <div class="input-group">
                                <input asp-for="ConfirmPassword" class="form-control border-end-0" type="password"
                                       id="confirmPassword" placeholder="Yeni şifrəni təkrar daxil edin">
                                <button class="btn btn-outline-secondary toggle-password" type="button"
                                        data-target="confirmPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <span asp-validation-for="ConfirmPassword" class="text-danger small d-block mt-1"></span>
                        </div>
                    </div>
                </div>

                <div class="form-group mt-4 pt-2 border-top">
                    <button type="submit" class="btn btn-primary px-4 py-2">
                        <i class="fas fa-save me-2"></i> Şifrəni yenilə
                    </button>
                    <a asp-action="UpdateProfile" class="btn btn-outline-secondary px-4 py-2 ms-2">
                        <i class="fas fa-arrow-left me-2"></i> Profilə qayıt
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        // Toggle password visibility
        $('.toggle-password').click(function() {
            const target = $(this).data('target');
            const input = $('#' + target);
            const icon = $(this).find('i');

            if (input.attr('type') === 'password') {
                input.attr('type', 'text');
                icon.removeClass('fa-eye').addClass('fa-eye-slash');
            } else {
                input.attr('type', 'password');
                icon.removeClass('fa-eye-slash').addClass('fa-eye');
            }
        });

        // Password strength indicator
        $('#newPassword').on('keyup', function() {
            const password = $(this).val();
            if (password.length > 0) {
                $('#passwordStrengthCard').removeClass('d-none');
                const strength = calculatePasswordStrength(password);
                updateStrengthIndicator(strength);
            } else {
                $('#passwordStrengthCard').addClass('d-none');
            }
        });

        function calculatePasswordStrength(password) {
            let strength = 0;

            // Length check
            if (password.length >= 6) strength += 1;
            if (password.length >= 8) strength += 1;

            // Character diversity
            if (/[A-Z]/.test(password)) strength += 1;
            if (/[0-9]/.test(password)) strength += 1;
            if (/[^A-Za-z0-9]/.test(password)) strength += 1;

            return Math.min(strength, 5); // Max 5
        }

        function updateStrengthIndicator(strength) {
            const $bar = $('#passwordStrengthBar');
            const $text = $('#passwordStrengthText');
            let percentage = strength * 20;
            let color = 'bg-danger';
            let text = 'Zəif';

            if (strength >= 3) {
                color = 'bg-warning';
                text = 'Orta';
            }
            if (strength >= 4) {
                color = 'bg-success';
                text = 'Güclü';
            }
            if (strength >= 5) {
                text = 'Çox güclü';
            }

            $bar.css('width', percentage + '%').removeClass('bg-danger bg-warning bg-success').addClass(color);
            $text.text(text + ' (' + percentage + '%)');
        }
    });
</script>

<style>
    .toggle-password {
        cursor: pointer;
        background-color: #f8f9fa;
        border-left: none;
    }

        .toggle-password:hover {
            background-color: #e9ecef;
        }

    .logo-header {
        display: flex;
        align-items: center;
        margin-bottom: 2rem;
    }

    .logo-text {
        margin-left: 1rem;
    }

        .logo-text h1 {
            margin-bottom: 0;
            font-size: 1.8rem;
            color: #1e3c72;
        }

        .logo-text small {
            color: #6c757d;
            font-size: 0.9rem;
        }

    .card-header {
        border-radius: 0.375rem 0.375rem 0 0 !important;
    }

    .form-label {
        font-weight: 500;
    }
</style>
